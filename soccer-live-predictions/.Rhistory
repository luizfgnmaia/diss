theme_bw() +
ylab("Cartões vermelhos (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.055) +
geom_abline(intercept = lm1$coefficients[1], slope = lm1$coefficients[2],
col = "red", size = 1)
t2 = tmp %>%
filter(Minuto < 45, Tempo == "2º")
lm2 = lm(p ~ Minuto, data = t2)
summary(lm2)
t2 %>%
ggplot(aes(x = Minuto, y = p)) +
geom_point(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Cartões vermelhos (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.055) +
geom_abline(intercept = lm2$coefficients[1], slope = lm2$coefficients[2],
col = "red", size = 1)
reds %>%
count(Ano, Time) %>%
mutate(m = n/380) %>%
ggplot(aes(x = Ano, y = m, col = Time)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
scale_x_continuous(breaks = 2015:2020) +
ylim(0, 0.2) +
ylab("Média de cartões por partida")
resultados$Acréscimos_1[which(resultados$Acréscimos_1 > 10)] = 10
resultados %>%
count(Acréscimos_1) %>%
mutate(p = n/nrow(resultados)) %>%
ggplot(aes(x = Acréscimos_1, y = p)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("") +
ylab("%") +
scale_x_continuous(breaks = 0:10,
labels = c(0:9, "10+"))
resultados$Acréscimos_2[which(resultados$Acréscimos_2 > 10)] = 10
resultados %>%
count(Acréscimos_2) %>%
mutate(p = n/nrow(resultados)) %>%
ggplot(aes(x = Acréscimos_2, y = p)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("") +
ylab("%") +
scale_x_continuous(breaks = 0:10,
labels = c(0:9, "10+"))
medias = results %>%
rename(Ano = Season) %>%
group_by(Ano) %>%
summarise(Acréscimos_1 = mean(Stoppage_Time_1),
Acréscimos_2 = mean(Stoppage_Time_2))
tibble(Tempo = c(rep("1º", nrow(medias)), rep("2º", nrow(medias))),
Ano = rep(medias$Ano, 2),
Média = c(medias$Acréscimos_1, medias$Acréscimos_2)) %>%
ggplot(aes(x = Ano, y = Média, col = Tempo)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Acréscimo médio (minutos)") +
ylim(0, 6)
options(OutDec = ",")
library(dplyr)
library(ggplot2)
load("scrape/data/goals.RData")
load("scrape/data/results.RData")
load("scrape/data/reds.RData")
resultados = results %>%
rename(Ano = Season,
Jogo = Match,
Placar_1 = Score_Home,
Placar_2 = Score_Away,
Acréscimos_1 = Stoppage_Time_1,
Acréscimos_2 = Stoppage_Time_2)
goals$Team[which(goals$Team == 1)] = "Mandante"
goals$Team[which(goals$Team == 2)] = "Visitante"
goals$Half[which(goals$Half == 1)] = "1º"
goals$Half[which(goals$Half == 2)] = "2º"
gols = goals %>%
rename(Ano = Season,
Jogo = Match,
Placar_1 = Score_Home,
Placar_2 = Score_Away,
Acréscimo = Stoppage_Time,
Minuto = Minute,
Time = Team,
Tempo = Half) %>%
mutate(Time = as.factor(Time),
Tempo = as.factor(Tempo))
reds$Team[which(reds$Team == 1)] = "Mandante"
reds$Team[which(reds$Team == 2)] = "Visitante"
reds$Half[which(reds$Half == 1)] = "1º"
reds$Half[which(reds$Half == 2)] = "2º"
reds = reds %>%
rename(Ano = Season,
Jogo = Match,
Placar_1 = Score_Home,
Placar_2 = Score_Away,
Acréscimo = Stoppage_Time,
Minuto = Minute,
Time = Team,
Tempo = Half) %>%
mutate(Time = as.factor(Time),
Tempo = as.factor(Tempo))
gols$Acréscimo[which(is.na(gols$Acréscimo))] = 0
gols = gols %>%
mutate(Minuto = Minuto + Acréscimo)
gols$Minuto[which(gols$Minuto > 50)] = 50
tmp = gols %>%
count(Minuto, Tempo) %>%
mutate(p = n/nrow(gols))
tmp %>%
ggplot(aes(x = Minuto, y = p, col = Tempo)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Gols (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 50, by = 5),
labels = c(seq(from = 0, to = 45, by = 5), "50+")) +
ylim(0, 0.0155)
t1 = tmp %>%
filter(Minuto < 45, Tempo == "1º")
lm1 = lm(p ~ Minuto, data = t1)
summary(lm1)
t1 %>%
ggplot(aes(x = Minuto, y = p)) +
geom_point(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Gols (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.0155) +
geom_abline(intercept = lm1$coefficients[1], slope = lm1$coefficients[2],
col = "red", size = 1)
t2 = tmp %>%
filter(Minuto < 45, Tempo == "2º")
lm2 = lm(p ~ Minuto, data = t2)
summary(lm2)
t2 %>%
ggplot(aes(x = Minuto, y = p)) +
geom_point(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Gols (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.0155) +
geom_abline(intercept = lm2$coefficients[1], slope = lm2$coefficients[2],
col = "red", size = 1)
resultados %>%
count(Placar_1, Placar_2) %>%
arrange(desc(n))
mandante = resultados %>%
count(Placar_1) %>%
na.omit() %>%
mutate(Time = "Mandante") %>%
rename(Placar = Placar_1)
visitante = resultados %>%
count(Placar_2) %>%
na.omit() %>%
mutate(Time = "Visitante") %>%
rename(Placar = Placar_2)
tmp = rbind(mandante, visitante) %>%
mutate(p = n/(nrow(resultados) - 1))
tmp %>%
ggplot(aes(fill = Time, y = p, x = Placar)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("Gols") +
ylab("Probabilidade") +
scale_x_continuous(breaks = 0:6)
tmp = resultados %>%
mutate(resultado = ifelse(Placar_1 == Placar_2, "Empate",
ifelse(Placar_1 > Placar_2, "Vitória do mandante",
"Vitória do visitante"))) %>%
count(resultado) %>%
arrange(desc(n)) %>%
mutate(p = n/(nrow(resultados)))
tmp
tmp %>%
mutate() %>%
na.omit() %>%
mutate(resultado = factor(resultado, levels = c("Vitória do mandante",
"Empate", "Vitória do visitante"))) %>%
ggplot(aes(x = resultado, y = p)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("") +
ylab("Probabilidade")
reds$Acréscimo[which(is.na(reds$Acréscimo))] = 0
reds = reds %>%
mutate(Minuto = Minuto + Acréscimo)
reds$Minuto[which(reds$Minuto > 50)] = 50
tib_zeros = tibble(Minuto = c(1:50, 1:50),
Tempo = c(rep("1º", 50), rep("2º", 50)), n = 0L)
complete_zeros <- function(tib_count) {
tib_count %>%
full_join(tib_zeros, by = c("Minuto", "Tempo", "n")) %>%
group_by(Minuto, Tempo) %>%
summarise(n = sum(n))
}
tmp = reds %>%
count(Minuto, Tempo) %>%
complete_zeros() %>%
mutate(p = n/nrow(reds))
tmp %>%
ggplot(aes(x = Minuto, y = p, col = Tempo)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Cartões vermelhos (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 50, by = 5),
labels = c(seq(from = 0, to = 45, by = 5), "50+")) +
ylim(0, 0.055)
t1 = tmp %>%
filter(Minuto < 45, Tempo == "1º")
lm1 = lm(p ~ Minuto, data = t1)
summary(lm1)
t1 %>%
ggplot(aes(x = Minuto, y = p)) +
geom_point(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Cartões vermelhos (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.055) +
geom_abline(intercept = lm1$coefficients[1], slope = lm1$coefficients[2],
col = "red", size = 1)
t2 = tmp %>%
filter(Minuto < 45, Tempo == "2º")
lm2 = lm(p ~ Minuto, data = t2)
summary(lm2)
t2 %>%
ggplot(aes(x = Minuto, y = p)) +
geom_point(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Cartões vermelhos (%)") +
scale_x_continuous(breaks = seq(from = 0, to = 45, by = 5)) +
ylim(0, 0.055) +
geom_abline(intercept = lm2$coefficients[1], slope = lm2$coefficients[2],
col = "red", size = 1)
reds %>%
count(Ano, Time) %>%
mutate(m = n/380) %>%
ggplot(aes(x = Ano, y = m, col = Time)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
scale_x_continuous(breaks = 2015:2020) +
ylim(0, 0.2) +
ylab("Média de cartões por partida")
resultados$Acréscimos_1[which(resultados$Acréscimos_1 > 10)] = 10
resultados %>%
count(Acréscimos_1) %>%
mutate(p = n/nrow(resultados)) %>%
ggplot(aes(x = Acréscimos_1, y = p)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("") +
ylab("Probabilidade") +
scale_x_continuous(breaks = 0:10,
labels = c(0:9, "10+"))
resultados$Acréscimos_2[which(resultados$Acréscimos_2 > 10)] = 10
resultados %>%
count(Acréscimos_2) %>%
mutate(p = n/nrow(resultados)) %>%
ggplot(aes(x = Acréscimos_2, y = p)) +
geom_bar(position = "dodge", stat = "identity") +
theme_bw() +
xlab("") +
ylab("Probabilidade") +
scale_x_continuous(breaks = 0:10,
labels = c(0:9, "10+"))
medias = results %>%
rename(Ano = Season) %>%
group_by(Ano) %>%
summarise(Acréscimos_1 = mean(Stoppage_Time_1),
Acréscimos_2 = mean(Stoppage_Time_2))
tibble(Tempo = c(rep("1º", nrow(medias)), rep("2º", nrow(medias))),
Ano = rep(medias$Ano, 2),
Média = c(medias$Acréscimos_1, medias$Acréscimos_2)) %>%
ggplot(aes(x = Ano, y = Média, col = Tempo)) +
geom_line(size = 1) +
geom_point(size = 2) +
theme_bw() +
ylab("Acréscimo médio (minutos)") +
ylim(0, 6)
load("scrape/data/results.RData")
load("scrape/data/goals.RData")
load("scrape/data/reds.RData")
library(dplyr)
load("scrape/data/results.RData")
load("scrape/data/goals.RData")
load("scrape/data/reds.RData")
reds = reds %>%
inner_join(results)
View(reds)
reds %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1)
reds %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>% View()
reds %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
reds %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
goals = goals %>%
inner_join(results)
goals %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
goals %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
goals %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time >= Stoppage_Time_2) %>%
filter(problem == TRUE)
goals %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
library(dplyr)
load("scrape/data/results.RData")
load("scrape/data/goals.RData")
load("scrape/data/reds.RData")
reds = reds %>%
inner_join(results)
reds %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
reds %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
goals = goals %>%
inner_join(results)
goals %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
goals %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
load("scrape/data/results.RData")
load("scrape/data/goals.RData")
load("scrape/data/reds.RData")
goals = goals %>%
inner_join(results)
goals %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
goals %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
reds = reds %>%
inner_join(results)
reds %>%
filter(Half == 1) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_1) %>%
filter(problem == TRUE)
reds %>%
filter(Half == 2) %>%
rowwise() %>%
mutate(problem = Stoppage_Time > Stoppage_Time_2) %>%
filter(problem == TRUE)
load("scrape/data/gols.RData")
load("scrape/data/goals.RData")
goals %>%
count(Season)
library(dplyr)
load("scrape/data/goals.RData")
goals %>%
count(Season)
68+61+64+59+55+53+51+52+38+50+54+45+40+48+31+34+37+41+31+32
86+60+61+64+51+39+44+42+50+46+44+39+44+38+31+36+27+24+31+18
86+60+61+64+51+39+44+42+50+46+44+38+44+38+31+36+27+24+31+18
library(rvest)
install.packages("rvest")
library(rvest)
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(.expand-trigger .hidden-xs:nth-child(7))
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)")
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
goals %>%
count(Season)
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2020" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
cnt = goals %>%
count(Season)
View(cnt)
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2020" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2018" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2017" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2016" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2015" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2017" %>%
read_html() %>%
html_nodes("td:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2016" %>%
read_html() %>%
html_nodes("td:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2015" %>%
read_html() %>%
html_nodes("td:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
r = results %>%
filter(Season == 2019)
r = results %>%
filter(Season == 2019)
load("scrape/data/results.RData")
r = results %>%
filter(Season == 2019)
sum(r$Score_Home) + sum(r$Score_Away)
"https://www.cbf.com.br/futebol-brasileiro/competicoes/campeonato-brasileiro-serie-a/2019" %>%
read_html() %>%
html_nodes(".expand-trigger .hidden-xs:nth-child(7)") %>%
html_text() %>%
as.numeric() %>%
sum()
