"0","options(knitr.kable.NA = ""â€“"","
"0","        scipen = 999)"
"0",""
"0","library(dplyr)"
"0","library(knitr)"
"0","library(reshape2)"
"0","library(ggplot2)"
"0",""
"0","load(""2015-2020/data/input.RData"")"
"0",""
"0","x = list(); y = list(); xy = list()"
"0","for(i in 1:N) {"
"0","  x[[i]] = c(x1[[i]], x2[[i]])"
"0","  y[[i]] = c(y1[[i]], y2[[i]])"
"0","  xy[[i]] = paste(x[[i]], y[[i]], sep = ""-"")"
"0","}"
"0",""
"0","tables = lapply(xy, table)"
"0",""
"0","scores = NULL"
"0","c = 0"
"0","for(i in 0:3) {"
"0","  for(j in 0:3) {"
"0","    c = c + 1"
"0","    scores[c] = paste(i, j, sep = ""-"")"
"0","  }"
"0","}"
"0",""
"0","delta_home = list(); delta_away = list(); t = list()"
"0",""
"0","for(i in 1:length(scores)) {"
"0","  tmp_delta_home = NULL; tmp_delta_away = NULL; tmp_t = NULL"
"0","  for(k in 1:N) {"
"0","    if(scores[i] %in% names(tables[[k]])) {"
"0","      next_score = names(tables[[k]])[which(names(tables[[k]]) == "
"0","                                              names(tables[[k]][scores[i]])) + 1]"
"0","      if(is.na(next_score)) {"
"0","        tmp_delta_home[k] = 0"
"0","        tmp_delta_away[k] = 0"
"0","      } else {"
"0","        if(as.integer(substr(next_score, 1, 1)) > as.integer(substr(scores[i], 1, 1))) {"
"0","          tmp_delta_home[k] = 1"
"0","          tmp_delta_away[k] = 0"
"0","        } else {"
"0","          tmp_delta_home[k] = 0"
"0","          tmp_delta_away[k] = 1"
"0","        }"
"0","      }"
"0","      tmp_t[k] = tables[[k]][scores[i]]"
"0","    } else {"
"0","      tmp_delta_home[k] = 0"
"0","      tmp_delta_away[k] = 0"
"0","      tmp_t[k] = 0"
"0","    }"
"0","  }"
"0","  delta_home[[i]] = tmp_delta_home"
"0","  delta_away[[i]] = tmp_delta_away"
"0","  t[[i]] = tmp_t"
"0","}"
"0",""
"0","rates = NULL; rates_home = NULL; rates_away = NULL"
"0","for(i in 1:length(scores)) {"
"0","  rates[i] = (sum(delta_home[[i]]) + sum(delta_away[[i]])) / sum(t[[i]])"
"0","  rates_home[i] = sum(delta_home[[i]]) / sum(t[[i]])"
"0","  rates_away[i] = sum(delta_away[[i]]) / sum(t[[i]])"
"0","}"
"0",""
"0","# Crowder pag 66"
"0","sd_home = NULL; sd_away = NULL; sd = NULL"
"0","for(i in 1:length(scores)) {"
"0","  sd[i] = rates[i] / sqrt(sum(delta_home[[i]]) + sum(delta_away[[i]]))"
"0","  sd_home[i] = rates_home[i] / sqrt(sum(delta_home[[i]]))"
"0","  sd_away[i] = rates_away[i] / sqrt(sum(delta_away[[i]]))"
"0","} "
"0",""
"0","tib = tibble(Rate = paste0(""$\\nu_{"", stringr::str_replace(scores, ""-"", """"), ""}$""), "
"0","             `Est.(both)` = rates, `Est.(home)` = rates_home, `Est.(away)` = rates_away,"
"0","             `S.e.(both)` = sd, `S.e.(home)` = sd_home, `S.e.(away)` = sd_away)"
